<!DOCTYPE html>
<html lang="en">
  
<head>
    <title>Play with sigma js</title>
    <script src="typedb-visualisation.js" type="text/javascript"></script>
    <script>
        // Set a few globals
        var visualiser = null;
        var renderer = null;

        // Initialisation on load
        window.onload= (()=> {
            let graph = new graphology.MultiGraph();
            renderer = createSigmaRenderer(document.getElementById('sigma-container'), studioDefaults.defaultSigmaSettings, graph);
            let layout = Layouts.createForceAtlasStatic(graph, undefined); // This is the safe option
            // let layout = Layouts.createForceLayoutSupervisor(graph, studioDefaults.defaultForceSupervisorSettings);
            visualiser = new GraphVisualiser(graph, renderer, layout);
         });

        async function visualiseFromAnswer(form) {
            let query_result = {ok: JSON.parse(form.query_response.value)}; // Mimic ApiResponse
            let highlightedQuery = "";
            if (query_result.ok.query != null) {
                visualiser.handleQueryResult(query_result);
                highlightedQuery = visualiser.colorQuery(form.query_text.value, query_result.ok.query);
                visualiser.colorEdgesByConstraintIndex(false);
            }
            document.getElementById("query-highlight-div").innerHTML = highlightedQuery;
        }
    </script>
</head>

<body>
    <div id="sigma-container" style="background-color: #0e0d17; height: 800px;">
        <!-- The graph will be draw in here. Leave empty -->
    </div>
    <div id="query-highlight-div" style="border: 2px solid black;"><span id="query-highlight"></span></div>
    <div id="input">
        <form id="query-or-graph-form" onsubmit="visualiseFromAnswer(this); return false">
            <div id="buttons">
                <span id="input-buttons-left">
                    <input type="submit" onclick="this.form.txType=this.value;" value="draw"/>
                </span>
                <span id="input-buttons-right" style="float: right;">
                    <input type="text" name="search"  placeholder="search nodes" onkeyup="visualiser.searchGraph(this.value)" />
                    GraphControls:
                    <button onclick="visualiser.layout.stop(); return false">freeze</button>
                    <button onclick="visualiser.layout.start(); return false">unfreeze</button>
                    <button onclick="visualiser.layout.redraw(); return false">redraw</button>
                </span>
            </div>
            <textarea name="query_response" id='query_response' style="width:100%;height: 400px" placeholder='Graph or response'></textarea>
            <textarea name="query_text" id='query' style="width:100%;height: 400px" placeholder="query if you want to know what you're looking at"></textarea>
        </form>
    </div>
</body>
</html>
